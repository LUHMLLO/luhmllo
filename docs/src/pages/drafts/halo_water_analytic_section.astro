---
import ShowcaseLayout from '@layouts/showcase.astro';
---

<ShowcaseLayout>
	<section data-is='grid' style='--cols: 2; --gap: 30px; padding: 60px;'>
		<div data-is='stack' style='gap: 30px;'>
			<h2>Bottle vs. Filter <br /> <big>Cost Breakdown</big></h2>

			<fieldset data-is='group' style='gap: 15px;'>
				<label for='number_of_household_members' data-is='field'>
					<span data-part='label'> Number of people in household </span>
					<input
						type='number'
						name='number_of_household_members'
						id='number_of_household_members'
						value='4'
					/>
				</label>

				<label for='gallons_per_person_per_day' data-is='field'>
					<span data-part='label'> Gallons per person per day </span>
					<input
						type='number'
						name='gallons_per_person_per_day'
						id='gallons_per_person_per_day'
						value='1.3'
					/>
				</label>

				<label for='price_per_gallon' data-is='field'>
					<span data-part='label'> Price per gallon ($) </span>
					<input
						type='number'
						name='price_per_gallon'
						id='price_per_gallon'
						value='1.79'
					/>
				</label>
			</fieldset>

			<div data-is='group' style='gap: 15px;'>
				<p>
					Youâ€™re projected to spend over <span>$33,974</span> on bottled water over
					the course of 10 years. However, investing in a whole-home water filtration
					system is a more cost-effective solution, with an initial cost of only
					<span>$8,500</span>.
				</p>

				<p>
					This represents a significant cost savings of <span>$25,474</span>,
					ensuring access to clean water at all faucets. ROI payback period: The
					duration of the project is estimated to be approximately <span
						>3 years</span
					>.
				</p>
			</div>
		</div>

		<div data-is='stack' style='gap: 60px;'>
			<canvas
				id='savingsChart'
				style='background-color: var(--clr-background__raised); border-radius: 5px; padding: 15px;'
			></canvas>
			<script src='https://cdn.jsdelivr.net/npm/chart.js'></script>
			<script type='module' is:inline>
				const householdSize = document.getElementById(
					'number_of_household_members'
				);
				const gallonsPerPerson = document.getElementById(
					'gallons_per_person_per_day'
				);
				const pricePerGallon = document.getElementById('price_per_gallon');
				// const summary = document.getElementById('summary');
				const chartCanvas = document.getElementById('savingsChart');
				let chart;

				function calculateAndRender() {
					const people = parseInt(householdSize.value);
					const gallons = parseFloat(gallonsPerPerson.value);
					const price = parseFloat(pricePerGallon.value);

					const annualBottledPerPerson = gallons * 365 * price;
					const annualBottledTotal = annualBottledPerPerson * people;

					const totalBottled = [];
					const totalFiltration = [];
					const maintenance = 100;
					const systemCost = 7500;
					const years = 10;

					for (let i = 1; i <= years; i++) {
						totalBottled.push(annualBottledTotal * i);
						totalFiltration.push(systemCost + maintenance * i);
					}

					const netSavings =
						annualBottledTotal * years -
						(systemCost + maintenance * years).toLocaleString(undefined, {
							minimumFractionDigits: 0,
							maximumFractionDigits: 0,
						});

					const paybackYear = Math.ceil(systemCost / annualBottledTotal);

					const projectionAmount = (annualBottledTotal * 10).toLocaleString(
						undefined,
						{ minimumFractionDigits: 0, maximumFractionDigits: 0 }
					);
					const totalInvestment = (
						systemCost +
						maintenance * 10
					).toLocaleString();

					if (chart) chart.destroy();
					chart = new Chart(chartCanvas, {
						type: 'line',
						data: {
							labels: [...Array(10).keys()].map((i) => `Year ${i + 1}`),
							datasets: [
								{
									label: 'Bottled Water Cost',
									data: totalBottled,
									borderColor: 'red',
									fill: false,
								},
								{
									label: 'Filtration System Cost',
									data: totalFiltration,
									borderColor: 'blue',
									fill: false,
								},
							],
						},
						options: {
							responsive: true,
							maintainAspectRatio: false,
							plugins: {
								legend: {
									position: 'top',
								},
								tooltip: {
									mode: 'index',
									intersect: false,
								},
							},
							scales: {
								y: {
									beginAtZero: true,
									ticks: {
										callback: function (value) {
											return '$' + value;
										},
									},
								},
							},
						},
					});
				}

				householdSize.addEventListener('change', calculateAndRender);
				gallonsPerPerson.addEventListener('input', calculateAndRender);
				pricePerGallon.addEventListener('input', calculateAndRender);

				// Initial render
				calculateAndRender();
			</script>
		</div>
	</section>

	<style lang='css' is:inline>
		@import url('https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap');

		@scope {
			:scope {
				font-family: 'DM Sans', sans-serif;
				overflow: auto;
			}
		}
	</style>
</ShowcaseLayout>
