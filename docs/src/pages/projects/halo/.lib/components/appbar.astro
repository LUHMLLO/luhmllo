---
import { Image } from 'astro:assets';
import AssetLogo from '../assets/hytech_h2o.png';
import { getBasePath } from 'src/utils/routeSegments';

const basePath = getBasePath(Astro.url.pathname, 2);
---

<hr id='top' style='height: 0; width: 0;' />

<nav id='appbar' data-layout='expand'>
	<div id='appbar__blur' data-has='blur'>
		<div data-part='layer' style='--i: 0;'></div>
		<div data-part='layer' style='--i: 1;'></div>
		<div data-part='layer' style='--i: 2;'></div>
		<div data-part='layer' style='--i: 3;'></div>
		<div data-part='layer' style='--i: 4;'></div>
		<div data-part='layer' style='--i: 5;'></div>

		<style lang='css' is:inline>
			@scope (#appbar__blur) {
				:scope {
					background: linear-gradient(
						180deg,
						rgba(255, 255, 255, 0.5) 0%,
						rgba(255, 255, 255, 0) 100%
					);
					height: 115px;
					inset: 0 0 auto 0;
					position: fixed;
					width: 100%;
					z-index: -1;

					@container xwindow (width < 800px) {
						z-index: 3;
					}
				}
			}
		</style>
	</div>

	<div id='appbar__logo'>
		<a href={basePath}>
			<figure style='height: 75px;'>
				<Image src={AssetLogo} alt='logo' decoding='async' loading='eager' />
			</figure>
		</a>
	</div>

	<div id='appbar__menu' data-is='flex' data-visible='false'>
		<a href={`${basePath}#about`} data-variant='text'>
			<span>About</span>
		</a>
		<a href={`${basePath}#cleanwater`} data-variant='text'>
			<span>Clean Water</span>
		</a>
		<a href={`${basePath}#products`} data-variant='text'>
			<span>Products</span>
		</a>
		<a href='https://hytechhome.com/' target='_blank' data-variant='text'>
			<span>Hytech Home</span>
			<i data-is='icon'>north_east</i>
		</a>
		<a href={`${basePath}#`} data-variant='text' data-condition='mobile-only'>
			<span>About us</span>
		</a>
		<a href={`${basePath}#`} data-variant='text' data-condition='mobile-only'>
			<span>Privacy policies</span>
		</a>
		<a
			href={`${basePath}/terms`}
			data-variant='text'
			data-condition='mobile-only'>
			<span>Terms of use</span>
		</a>
		<div data-is='stack' data-condition='mobile-only'>
			<a href={`${basePath}#contact`} data-is='button'>
				<span>Get in Contact</span>
			</a>
		</div>
	</div>

	<div id='appbar__options' data-is='row'>
		<a href={`${basePath}#contact`} data-is='button'>
			<span>Get in Contact</span>
		</a>

		<button data-toggle-menu>
			<i data-is='icon'>
				<span data-visible='true'>menu</span>
				<span data-visible='false'>close</span>
			</i>
		</button>
	</div>

	<script type='module' is:inline>
		window.addEventListener('DOMContentLoaded', () => {
			const menu = document.querySelector('#appbar__menu');
			const buttons = document.querySelectorAll('[data-toggle-menu]');
			if (!menu || !buttons) return;

			const setVisibility = (visible) => {
				menu.dataset.visible = visible;

				buttons.forEach((el) => {
					const spans = el.querySelectorAll('i span');
					spans.forEach((span) => {
						const currentlyVisible = span.dataset.visible === 'true';
						span.dataset.visible = (!currentlyVisible).toString();
					});
				});

				// Emit visibility change
				dispatchEvent(
					new CustomEvent('menu:visibility', {
						detail: { visible },
					})
				);
			};

			document.querySelectorAll('[data-toggle-menu]').forEach((el) =>
				el.addEventListener('click', () => {
					const nowVisible = menu.dataset.visible !== 'true';
					setVisibility(nowVisible);
				})
			);

			menu.querySelectorAll('a').forEach((el) =>
				el.addEventListener('click', () => {
					const nowVisible = menu.dataset.visible !== 'true';
					setVisibility(nowVisible);
				})
			);
		});
	</script>

	<style lang='css' is:inline>
		@scope (#appbar) {
			:scope {
				align-items: center;
				height: 115px;
				inset: 0 0 auto 0;
				overflow: visible;
				position: fixed;
				z-index: 1;

				& > div {
					align-items: inherit;
					flex: 1 1;
					gap: var(--md);
				}

				#appbar__menu {
					flex: 2 1;
					justify-content: center;

					a {
						font-weight: 500;
					}

					[data-condition='mobile-only'] {
						display: none;
					}
				}

				#appbar__options {
					justify-content: end;

					button[data-toggle-menu] {
						display: none;
					}
				}

				@container xwindow (width < 800px) {
					#appbar__logo {
						z-index: 3;
					}

					#appbar__menu {
						align-items: start;
						background-color: var(--clr-background__raised);
						flex-direction: column;
						gap: 0;
						inset: 0;
						justify-content: start;
						overflow: clip auto;
						padding-top: 115px;
						position: fixed;
						z-index: 2;

						& > * {
							width: 100%;
						}

						a:not([data-is='button']) {
							padding: var(--xl);
							text-align: left;

							&:hover {
								background-color: var(--clr-background__base);
							}

							&:active {
								background-color: var(--clr-background__lowered);
							}

							&:not(:last-child) {
								border-bottom: solid 2px var(--clr-border__base);
							}
						}

						&[data-visible='false'] {
							display: none;
						}

						[data-condition='mobile-only'] {
							display: revert-layer;
						}

						& > [data-is='stack'] {
							background-color: var(--clr-background__lowered);
							bottom: 0;
							flex: 1 0;
							min-height: max-content;
							padding: var(--xl);
							place-content: end;

							& > * {
								flex-shrink: 0;
								width: 100%;
							}
						}
					}

					#appbar__options {
						& > a {
							display: none;
						}

						button[data-toggle-menu] {
							display: revert-layer;
							z-index: 3;

							& > i > span[data-visible='false'] {
								display: none;
							}
						}
					}
				}
			}
		}
	</style>
</nav>
