// deno-lint-ignore-file
var v=Object.defineProperty;var p=(o,t,e)=>t in o?v(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var n=(o,t,e)=>p(o,typeof t!="symbol"?t+"":t,e);var m=class{constructor(t,e,s={}){n(this,"orbiterElement");n(this,"boundaryElement");n(this,"options");n(this,"state");n(this,"rafId",null);n(this,"resizeObserver",null);n(this,"handleMouseMove");n(this,"handleMouseLeave");n(this,"handleTouchMove");n(this,"handleTouchEnd");n(this,"isDestroyed",!1);n(this,"isInitialized",!1);this.orbiterElement=t,this.boundaryElement=e,this.options=this.u(s),this.state={current:{x:0,y:0},target:{x:0,y:0},constraints:{maxX:0,maxY:0,centerX:0,centerY:0},isAnimating:!1,isTracking:!1,animationId:null,lastUpdateTime:0},this.handleMouseMove=this.c.bind(this),this.handleMouseLeave=this.i.bind(this),this.handleTouchMove=this.d.bind(this),this.handleTouchEnd=this.l.bind(this),this.m(),this.s(),this.n(),this.b(),this.e(),this.isInitialized=!0}u(t){return{factor:t.factor??1,smoothing:{enabled:t.smoothing?.enabled??!0,speed:t.smoothing?.speed??.1},touch:{enabled:t.touch?.enabled??!0,useFirstTouch:t.touch?.useFirstTouch??!0},constraintMode:t.constraintMode??"clamp",elastic:{tension:t.elastic?.tension??625e-6,snapBackDuration:t.elastic?.snapBackDuration??256},onLeave:t.onLeave??"reset",resetAnimation:{duration:t.resetAnimation?.duration??256,easing:t.resetAnimation?.easing??"easeInOut"}}}m(){if(!this.orbiterElement||!this.boundaryElement)throw new Error("Orbiter requires valid orbiter and boundary elements");if(this.options.smoothing.speed<0||this.options.smoothing.speed>1)throw new Error("Smoothing speed must be between 0 and 1");if(this.options.elastic.tension<0||this.options.elastic.tension>1)throw new Error("Elastic tension must be between 0 and 1")}s(){if(this.isDestroyed)return;let t=this.boundaryElement.getBoundingClientRect(),e=this.orbiterElement.getBoundingClientRect(),s={maxX:Math.max(0,(t.width-e.width)/2),maxY:Math.max(0,(t.height-e.height)/2),centerX:t.width/2,centerY:t.height/2};(Math.abs(this.state.constraints.maxX-s.maxX)>1||Math.abs(this.state.constraints.maxY-s.maxY)>1||Math.abs(this.state.constraints.centerX-s.centerX)>1||Math.abs(this.state.constraints.centerY-s.centerY)>1)&&(this.state.constraints=s)}n(){this.isDestroyed||(this.boundaryElement.addEventListener("mousemove",this.handleMouseMove,{passive:!0}),this.boundaryElement.addEventListener("mouseleave",this.handleMouseLeave,{passive:!0}),this.options.touch.enabled&&(this.boundaryElement.addEventListener("touchmove",this.handleTouchMove,{passive:!0}),this.boundaryElement.addEventListener("touchend",this.handleTouchEnd,{passive:!0}),this.boundaryElement.addEventListener("touchcancel",this.handleTouchEnd,{passive:!0})))}a(){this.boundaryElement.removeEventListener("mousemove",this.handleMouseMove),this.boundaryElement.removeEventListener("mouseleave",this.handleMouseLeave),this.options.touch.enabled&&(this.boundaryElement.removeEventListener("touchmove",this.handleTouchMove),this.boundaryElement.removeEventListener("touchend",this.handleTouchEnd),this.boundaryElement.removeEventListener("touchcancel",this.handleTouchEnd))}b(){if(!globalThis.ResizeObserver||this.isDestroyed)return;let t;this.resizeObserver=new ResizeObserver(()=>{t&&clearTimeout(t),t=setTimeout(()=>{this.isDestroyed||this.s(),t=void 0},16)}),this.resizeObserver.observe(this.boundaryElement),this.resizeObserver.observe(this.orbiterElement)}r(t,e){let s=this.boundaryElement.getBoundingClientRect(),i=t-s.left,a=e-s.top,h=(i-this.state.constraints.centerX)*this.options.factor,u=(a-this.state.constraints.centerY)*this.options.factor;return this.v(h,u)}v(t,e){let{maxX:s,maxY:i}=this.state.constraints;switch(this.options.constraintMode){case"clamp":return{x:Math.max(-s,Math.min(t,s)),y:Math.max(-i,Math.min(e,i))};case"elastic":{let a=this.options.elastic.tension;return{x:t>s?s+(t-s)*a:t<-s?-s+(t+s)*a:t,y:e>i?i+(e-i)*a:e<-i?-i+(e+i)*a:e}}case"none":default:return{x:t,y:e}}}e(){this.isDestroyed||(this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{if(this.isDestroyed)return;let{x:t,y:e}=this.state.current;this.orbiterElement.style.setProperty("--translate-x",`${t}px`),this.orbiterElement.style.setProperty("--translate-y",`${e}px`),this.orbiterElement.style.setProperty("--translate-z","0px"),this.rafId=null}))}o(){if(this.state.animationId||this.isDestroyed)return;let t=e=>{if(!this.state.isAnimating||this.isDestroyed){this.state.animationId=null;return}if(this.state.lastUpdateTime=e,this.options.smoothing.enabled){let s=this.options.smoothing.speed,i=this.state.target.x-this.state.current.x,a=this.state.target.y-this.state.current.y;this.state.current.x+=i*s,this.state.current.y+=a*s,i*i+a*a<.01&&!this.state.isTracking&&(this.state.current.x=this.state.target.x,this.state.current.y=this.state.target.y,this.state.isAnimating=!1)}else this.state.current.x=this.state.target.x,this.state.current.y=this.state.target.y,this.state.isTracking||(this.state.isAnimating=!1);this.e(),this.state.isAnimating&&!this.isDestroyed?this.state.animationId=requestAnimationFrame(t):this.state.animationId=null};this.state.isAnimating=!0,this.state.lastUpdateTime=performance.now(),this.state.animationId=requestAnimationFrame(t)}t(){this.state.isAnimating=!1,this.state.animationId&&(cancelAnimationFrame(this.state.animationId),this.state.animationId=null)}h(){if(this.isDestroyed)return;this.t();let t=performance.now(),e=this.state.current.x,s=this.state.current.y,{duration:i,easing:a}=this.options.resetAnimation,h=r=>{switch(a){case"easeOut":return 1-Math.pow(1-r,3);case"easeInOut":return r<.5?2*r*r:1-Math.pow(-2*r+2,3)/2;case"linear":return r;default:return 1-Math.pow(1-r,2)}},u,c=r=>{if(this.isDestroyed)return;let b=r-t,d=Math.min(b/i,1),l=h(d);this.state.current.x=e*(1-l),this.state.current.y=s*(1-l),this.state.target.x=this.state.current.x,this.state.target.y=this.state.current.y,this.e(),d<1&&!this.isDestroyed?u=requestAnimationFrame(c):this.state.isAnimating=!1};this.state.isAnimating=!0,u=requestAnimationFrame(c)}c(t){this.isDestroyed||(this.state.isTracking=!0,this.state.target=this.r(t.clientX,t.clientY),this.o())}i(){if(!this.isDestroyed)switch(this.state.isTracking=!1,this.options.onLeave){case"reset":this.h();break;case"freeze":this.t();break;case"continue":this.options.smoothing.enabled||this.t();break}}d(t){if(this.isDestroyed||!this.options.touch.enabled||t.touches.length===0)return;let e=this.options.touch.useFirstTouch?t.touches[0]:t.touches[t.touches.length-1];this.state.isTracking=!0,this.state.target=this.r(e.clientX,e.clientY),this.o()}l(){this.isDestroyed||this.i()}configure(t){if(this.isDestroyed)return;let e=this.options.touch.enabled;Object.assign(this.options,t),e!==this.options.touch.enabled&&(this.a(),this.n()),this.s()}getPosition(){return{...this.state.current}}setPosition(t,e){this.isDestroyed||(this.state.current.x=t,this.state.current.y=e,this.state.target.x=t,this.state.target.y=e,this.e())}reset(){this.isDestroyed||this.h()}pause(){this.isDestroyed||(this.state.isTracking=!1,this.t())}resume(){this.isDestroyed}destroy(){this.isDestroyed||(this.t(),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.a(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.state.animationId=null,this.state.isAnimating=!1,this.state.isTracking=!1,this.isDestroyed=!0)}};export{m as Orbiter};
