// deno-lint-ignore-file
var c=class{orbiterElement;boundaryElement;options;state;rafId=null;resizeObserver=null;constructor(t,e,s={}){this.orbiterElement=t,this.boundaryElement=e,this.options=this.h(s),this.state={current:{x:0,y:0},target:{x:0,y:0},constraints:{maxX:0,maxY:0,centerX:0,centerY:0},isAnimating:!1,isTracking:!1,animationId:null,lastUpdateTime:0},this.u(),this.a(),this.c(),this.m(),this.l(),this.s()}h(t){return{factor:t.factor??1,smoothing:{enabled:t.smoothing?.enabled??!0,speed:t.smoothing?.speed??.12},touch:{enabled:t.touch?.enabled??!0,useFirstTouch:t.touch?.useFirstTouch??!0},constraintMode:t.constraintMode??"clamp",elastic:{tension:t.elastic?.tension??.2,snapBackDuration:t.elastic?.snapBackDuration??300},onLeave:t.onLeave??"reset",resetAnimation:{duration:t.resetAnimation?.duration??400,easing:t.resetAnimation?.easing??"easeOut"}}}u(){if(!this.orbiterElement||!this.boundaryElement)throw new Error("Orbiter requires valid orbiter and boundary elements");if(this.options.smoothing.speed<0||this.options.smoothing.speed>1)throw new Error("Smoothing speed must be between 0 and 1");if(this.options.elastic.tension<0||this.options.elastic.tension>1)throw new Error("Elastic tension must be between 0 and 1")}a(){let t=this.boundaryElement.getBoundingClientRect(),e=this.orbiterElement.getBoundingClientRect();this.state.constraints={maxX:Math.max(0,(t.width-e.width)/2),maxY:Math.max(0,(t.height-e.height)/2),centerX:t.width/2,centerY:t.height/2}}c(){this.i=this.i.bind(this),this.t=this.t.bind(this),this.n=this.n.bind(this),this.e=this.e.bind(this)}m(){this.boundaryElement.addEventListener("mousemove",this.i),this.boundaryElement.addEventListener("mouseleave",this.t),this.options.touch.enabled&&(this.boundaryElement.addEventListener("touchmove",this.n,{passive:!0}),this.boundaryElement.addEventListener("touchend",this.e),this.boundaryElement.addEventListener("touchcancel",this.e))}l(){window.ResizeObserver&&(this.resizeObserver=new ResizeObserver(()=>{this.a()}),this.resizeObserver.observe(this.boundaryElement),this.resizeObserver.observe(this.orbiterElement))}r(t,e){let s=this.boundaryElement.getBoundingClientRect(),i=t-s.left,n=e-s.top,o=(i-this.state.constraints.centerX)*this.options.factor,r=(n-this.state.constraints.centerY)*this.options.factor;return this.d(o,r)}d(t,e){let{maxX:s,maxY:i}=this.state.constraints;switch(this.options.constraintMode){case"clamp":return{x:Math.max(-s,Math.min(t,s)),y:Math.max(-i,Math.min(e,i))};case"elastic":let n=this.options.elastic.tension;return{x:t>s?s+(t-s)*n:t<-s?-s+(t+s)*n:t,y:e>i?i+(e-i)*n:e<-i?-i+(e+i)*n:e};case"none":default:return{x:t,y:e}}}s(){this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{this.orbiterElement.style.setProperty("--translate-x",`${this.state.current.x}px`),this.orbiterElement.style.setProperty("--translate-y",`${this.state.current.y}px`),this.orbiterElement.style.setProperty("--translate-z","0px"),this.rafId=null})}o(){if(this.state.animationId)return;let t=e=>{if(!this.state.isAnimating){this.state.animationId=null;return}let s=e-this.state.lastUpdateTime;if(this.state.lastUpdateTime=e,this.options.smoothing.enabled){let i=this.options.smoothing.speed;this.state.current.x+=(this.state.target.x-this.state.current.x)*i,this.state.current.y+=(this.state.target.y-this.state.current.y)*i,Math.sqrt(Math.pow(this.state.target.x-this.state.current.x,2)+Math.pow(this.state.target.y-this.state.current.y,2))<.1&&!this.state.isTracking&&(this.state.isAnimating=!1)}else this.state.current.x=this.state.target.x,this.state.current.y=this.state.target.y,this.state.isTracking||(this.state.isAnimating=!1);this.s(),this.state.isAnimating?this.state.animationId=requestAnimationFrame(t):this.state.animationId=null};this.state.isAnimating=!0,this.state.lastUpdateTime=performance.now(),this.state.animationId=requestAnimationFrame(t)}b(){let t=performance.now(),e=this.state.current.x,s=this.state.current.y,{duration:i,easing:n}=this.options.resetAnimation,o=a=>{switch(n){case"easeOut":return 1-Math.pow(1-a,3);case"easeInOut":return a<.5?2*a*a:1-Math.pow(-2*a+2,3)/2;case"linear":return a;default:return 1-Math.pow(1-a,2)}},r=a=>{let m=a-t,h=Math.min(m/i,1),u=o(h);this.state.current.x=e*(1-u),this.state.current.y=s*(1-u),this.state.target.x=this.state.current.x,this.state.target.y=this.state.current.y,this.s(),h<1?requestAnimationFrame(r):this.state.isAnimating=!1};this.state.isAnimating=!0,requestAnimationFrame(r)}i(t){this.state.isTracking=!0,this.state.target=this.r(t.clientX,t.clientY),this.o()}t(){switch(this.state.isTracking=!1,this.options.onLeave){case"reset":this.b();break;case"freeze":break;case"continue":this.options.smoothing.enabled||(this.state.isAnimating=!1);break}}n(t){if(!this.options.touch.enabled||t.touches.length===0)return;let e=this.options.touch.useFirstTouch?t.touches[0]:t.touches[t.touches.length-1];this.state.isTracking=!0,this.state.target=this.r(e.clientX,e.clientY),this.o()}e(){this.t()}};export{c as Orbiter};
