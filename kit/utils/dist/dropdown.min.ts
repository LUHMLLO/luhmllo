// deno-lint-ignore-file
var b=Object.defineProperty;var p=(l,t)=>b(l,"name",{value:t,configurable:!0});function c(l,t){let i;return function(...o){i||(l.apply(this,o),i=!0,setTimeout(()=>i=!1,t))}}p(c,"throttle");var g=class{static{p(this,"DropdownAnchor")}detailsElement;dropdownContent;trigger;options;resizeObserver;mutationObserver;clickOutsideHandler;toggleHandler;handleUpdatePosition;isDestroyed=!1;originalParent=null;originalNextSibling=null;isPortaled=!1;constructor(t,i,o={}){if(this.detailsElement=t,this.dropdownContent=i,this.trigger=t.querySelector("summary"),!this.trigger)throw new Error("DropdownAnchor: No <summary> element found in <details>");this.options={preferredY:"bottom",preferredX:"left",viewportMargin:5,gap:5,animated:!0,portal:!1,portalTo:document.body,...o},this.clickOutsideHandler=this.handleClickOutside.bind(this),this.toggleHandler=this.handleToggle.bind(this),this.handleUpdatePosition=this.updatePosition.bind(this),this.initializeDropdown(),this.setupObservers()}initializeDropdown(){this.options.animated||(this.dropdownContent.style.transition="none"),this.options.portal&&(this.originalParent=this.dropdownContent.parentElement,this.originalNextSibling=this.dropdownContent.nextElementSibling),this.detailsElement.addEventListener("toggle",this.toggleHandler),this.detailsElement.open&&this.handleUpdatePosition()}enablePortal(){!this.options.portal||this.isPortaled||(this.options.portalTo.appendChild(this.dropdownContent),this.isPortaled=!0)}disablePortal(){!this.options.portal||!this.isPortaled||!this.originalParent||(this.originalNextSibling?this.originalParent.insertBefore(this.dropdownContent,this.originalNextSibling):this.originalParent.appendChild(this.dropdownContent),this.isPortaled=!1)}handleToggle(t){this.detailsElement.open?(this.enablePortal(),this.handleUpdatePosition(),document.addEventListener("click",this.clickOutsideHandler)):(document.removeEventListener("click",this.clickOutsideHandler),this.disablePortal())}handleClickOutside(t){let i=t.target;!this.detailsElement.contains(i)&&!this.dropdownContent.contains(i)&&(this.detailsElement.open=!1)}calculatePosition(){let t=this.trigger.getBoundingClientRect(),i=this.dropdownContent.getBoundingClientRect(),o={width:globalThis.innerWidth,height:globalThis.innerHeight},e=0,n=0,s=this.options.preferredY,h=this.options.preferredX,v=o.height-t.bottom-this.options.viewportMargin,d=t.top-this.options.viewportMargin,r=i.height||200;this.options.preferredY==="bottom"?v>=r+this.options.gap?(n=t.bottom+this.options.gap,s="bottom"):d>=r+this.options.gap?(n=t.top-r-this.options.gap,s="top"):v>d?(n=t.bottom+this.options.gap,s="bottom"):(n=t.top-r-this.options.gap,s="top"):d>=r+this.options.gap?(n=t.top-r-this.options.gap,s="top"):(n=t.bottom+this.options.gap,s="bottom");let a=i.width||200;switch(this.options.preferredX){case"left":e=t.left,e+a>o.width-this.options.viewportMargin&&(e=t.right-a,h="right");break;case"right":e=t.right-a,e<this.options.viewportMargin&&(e=t.left,h="left");break;case"center":e=t.left+(t.width-a)/2,e<this.options.viewportMargin?(e=this.options.viewportMargin,h="left"):e+a>o.width-this.options.viewportMargin&&(e=o.width-a-this.options.viewportMargin,h="right");break}return e=Math.max(this.options.viewportMargin,Math.min(e,o.width-a-this.options.viewportMargin)),n=Math.max(this.options.viewportMargin,Math.min(n,o.height-r-this.options.viewportMargin)),{x:e,y:n,placement:{vertical:s,horizontal:h}}}updatePosition(){if(!this.detailsElement.open)return;let t=this.calculatePosition();this.dropdownContent.style.setProperty("--translate-y",`${t.y}px`),this.dropdownContent.style.setProperty("--translate-x",`${t.x}px`)}setupObservers(){globalThis.addEventListener("scroll",c(this.handleUpdatePosition,50),{passive:!0}),globalThis.addEventListener("resize",c(this.handleUpdatePosition,50),{passive:!0}),globalThis.ResizeObserver&&(this.resizeObserver=new ResizeObserver(this.handleUpdatePosition),this.resizeObserver.observe(this.dropdownContent)),globalThis.MutationObserver&&(this.mutationObserver=new MutationObserver(this.handleUpdatePosition),this.mutationObserver.observe(this.dropdownContent,{childList:!0,subtree:!0,attributes:!1}))}open(){this.isDestroyed||(this.detailsElement.open=!0)}close(){this.isDestroyed||(this.detailsElement.open=!1)}toggle(){this.isDestroyed||(this.detailsElement.open=!this.detailsElement.open)}configure(t){Object.assign(this.options,t),this.handleUpdatePosition()}destroy(){this.disablePortal(),this.detailsElement.removeEventListener("toggle",this.toggleHandler),document.removeEventListener("click",this.clickOutsideHandler),globalThis.removeEventListener("scroll",this.handleUpdatePosition),globalThis.removeEventListener("resize",this.handleUpdatePosition),this.resizeObserver?.disconnect(),this.mutationObserver?.disconnect(),this.isDestroyed=!0}};function m(l,t,i){return new g(l,t,i)}p(m,"anchorDropdown");export{g as DropdownAnchor,m as anchorDropdown};
