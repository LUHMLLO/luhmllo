// deno-lint-ignore-file
var b=Object.defineProperty;var r=(u,t)=>b(u,"name",{value:t,configurable:!0});var m=class{static{r(this,"Orbiter")}orbiterElement;boundaryElement;options;state;rafId=null;resizeObserver=null;constructor(t,e,s={}){this.orbiterElement=t,this.boundaryElement=e,this.options=this._applyDefaults(s),this.state={current:{x:0,y:0},target:{x:0,y:0},constraints:{maxX:0,maxY:0,centerX:0,centerY:0},isAnimating:!1,isTracking:!1,animationId:null,lastUpdateTime:0},this._validateConfiguration(),this._calculateConstraints(),this._bindEventHandlers(),this._attachEventListeners(),this._setupResizeObserver(),this._updateTransform()}_applyDefaults(t){return{factor:t.factor??1,smoothing:{enabled:t.smoothing?.enabled??!0,speed:t.smoothing?.speed??.12},touch:{enabled:t.touch?.enabled??!0,useFirstTouch:t.touch?.useFirstTouch??!0},constraintMode:t.constraintMode??"clamp",elastic:{tension:t.elastic?.tension??.2,snapBackDuration:t.elastic?.snapBackDuration??300},onLeave:t.onLeave??"reset",resetAnimation:{duration:t.resetAnimation?.duration??400,easing:t.resetAnimation?.easing??"easeOut"}}}_validateConfiguration(){if(!this.orbiterElement||!this.boundaryElement)throw new Error("Orbiter requires valid orbiter and boundary elements");if(this.options.smoothing.speed<0||this.options.smoothing.speed>1)throw new Error("Smoothing speed must be between 0 and 1");if(this.options.elastic.tension<0||this.options.elastic.tension>1)throw new Error("Elastic tension must be between 0 and 1")}_calculateConstraints(){let t=this.boundaryElement.getBoundingClientRect(),e=this.orbiterElement.getBoundingClientRect();this.state.constraints={maxX:Math.max(0,(t.width-e.width)/2),maxY:Math.max(0,(t.height-e.height)/2),centerX:t.width/2,centerY:t.height/2}}_bindEventHandlers(){this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseLeave=this._handleMouseLeave.bind(this),this._handleTouchMove=this._handleTouchMove.bind(this),this._handleTouchEnd=this._handleTouchEnd.bind(this)}_attachEventListeners(){this.boundaryElement.addEventListener("mousemove",this._handleMouseMove),this.boundaryElement.addEventListener("mouseleave",this._handleMouseLeave),this.options.touch.enabled&&(this.boundaryElement.addEventListener("touchmove",this._handleTouchMove,{passive:!0}),this.boundaryElement.addEventListener("touchend",this._handleTouchEnd),this.boundaryElement.addEventListener("touchcancel",this._handleTouchEnd))}_setupResizeObserver(){globalThis.ResizeObserver&&(this.resizeObserver=new ResizeObserver(()=>{this._calculateConstraints()}),this.resizeObserver.observe(this.boundaryElement),this.resizeObserver.observe(this.orbiterElement))}_calculateTargetPosition(t,e){let s=this.boundaryElement.getBoundingClientRect(),n=t-s.left,a=e-s.top,h=(n-this.state.constraints.centerX)*this.options.factor,o=(a-this.state.constraints.centerY)*this.options.factor;return this._applyConstraints(h,o)}_applyConstraints(t,e){let{maxX:s,maxY:n}=this.state.constraints;switch(this.options.constraintMode){case"clamp":return{x:Math.max(-s,Math.min(t,s)),y:Math.max(-n,Math.min(e,n))};case"elastic":{let a=this.options.elastic.tension;return{x:t>s?s+(t-s)*a:t<-s?-s+(t+s)*a:t,y:e>n?n+(e-n)*a:e<-n?-n+(e+n)*a:e}}case"none":default:return{x:t,y:e}}}_updateTransform(){this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{this.orbiterElement.style.setProperty("--translate-x",`${this.state.current.x}px`),this.orbiterElement.style.setProperty("--translate-y",`${this.state.current.y}px`),this.orbiterElement.style.setProperty("--translate-z","0px"),this.rafId=null})}_startAnimationLoop(){if(this.state.animationId)return;let t=r(e=>{if(!this.state.isAnimating){this.state.animationId=null;return}if(this.state.lastUpdateTime=e,this.options.smoothing.enabled){let s=this.options.smoothing.speed;this.state.current.x+=(this.state.target.x-this.state.current.x)*s,this.state.current.y+=(this.state.target.y-this.state.current.y)*s,Math.sqrt(Math.pow(this.state.target.x-this.state.current.x,2)+Math.pow(this.state.target.y-this.state.current.y,2))<.1&&!this.state.isTracking&&(this.state.isAnimating=!1)}else this.state.current.x=this.state.target.x,this.state.current.y=this.state.target.y,this.state.isTracking||(this.state.isAnimating=!1);this._updateTransform(),this.state.isAnimating?this.state.animationId=requestAnimationFrame(t):this.state.animationId=null},"animate");this.state.isAnimating=!0,this.state.lastUpdateTime=performance.now(),this.state.animationId=requestAnimationFrame(t)}_animateToCenter(){let t=performance.now(),e=this.state.current.x,s=this.state.current.y,{duration:n,easing:a}=this.options.resetAnimation,h=r(i=>{switch(a){case"easeOut":return 1-Math.pow(1-i,3);case"easeInOut":return i<.5?2*i*i:1-Math.pow(-2*i+2,3)/2;case"linear":return i;default:return 1-Math.pow(1-i,2)}},"getEasingValue"),o=r(i=>{let d=i-t,c=Math.min(d/n,1),l=h(c);this.state.current.x=e*(1-l),this.state.current.y=s*(1-l),this.state.target.x=this.state.current.x,this.state.target.y=this.state.current.y,this._updateTransform(),c<1?requestAnimationFrame(o):this.state.isAnimating=!1},"animate");this.state.isAnimating=!0,requestAnimationFrame(o)}_handleMouseMove(t){this.state.isTracking=!0,this.state.target=this._calculateTargetPosition(t.clientX,t.clientY),this._startAnimationLoop()}_handleMouseLeave(){switch(this.state.isTracking=!1,this.options.onLeave){case"reset":this._animateToCenter();break;case"freeze":break;case"continue":this.options.smoothing.enabled||(this.state.isAnimating=!1);break}}_handleTouchMove(t){if(!this.options.touch.enabled||t.touches.length===0)return;let e=this.options.touch.useFirstTouch?t.touches[0]:t.touches[t.touches.length-1];this.state.isTracking=!0,this.state.target=this._calculateTargetPosition(e.clientX,e.clientY),this._startAnimationLoop()}_handleTouchEnd(){this._handleMouseLeave()}};export{m as Orbiter};
